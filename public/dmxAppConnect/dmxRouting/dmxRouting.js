/*!
 App Connect Routing
 Version: 3.0.0-beta.2
 (c) 2023 Wappler.io
 @build 2023-05-26 15:56:21
 */
dmx.config.mapping.a="link",dmx.routing={router:"hybrid",base:"",routes:[],getRoutes(){return this.routes.filter((function(t){return!t.app||t.app==dmx.app.name}))},getBase(){if(this.base)return this.base;var t=document.querySelector("base[href]");return t?t.getAttribute("href"):""},getUrlInfo(){var t="hash"==this.router?new URL(window.location.hash.slice(2),window.location.origin):window.location;return{path:t.pathname||"/",query:t.search.slice(1),hash:t.hash.slice(1)}},match(t,e,i){t=t||this.getUrlInfo().path,e=e||this.getRoutes();var r=dmx.routing.getBase();r&&(t=t.replace(r,"").replace(/^\/?/,"/"));for(var n=0;n<e.length;n++){e[n].routes&&(e[n].end=!1);var s=[],o=dmx.pathToRegexp(dmx.routing.join(i&&i.path?i.path:"/",e[n].path),s,e[n]).exec(decodeURI(t));if(o)return{path:o[0],params:s.reduce((function(t,e,i){return t[e.name]=o[i+1],t}),{}),url:e[n].url,routes:e[n].routes||[]}}return null},join:(t,e)=>t.replace(/\/$/,"")+"/"+e.replace(/^\//,""),evalScripts(t){window.grecaptcha&&t.querySelectorAll(".g-recaptcha").forEach((t=>{grecaptcha.render(t)}));try{t.querySelectorAll('script[type="text/javascript"],script:not([type])').forEach((t=>{try{const e=document.createElement("script");e.type="text/javascript",t.src&&(e.src=t.src),t.innerHTML&&(e.innerHTML=t.innerHTML),t.parentNode.replaceChild(e,t)}catch(e){console.error("Error executing script "+t.src,e)}}))}catch(t){console.error("An error occurred while trying to execute scripts",t)}}},dmx.Component("route",{initialData:{isExact:!1,isMatch:!1,loading:!1,params:{},path:"",url:""},attributes:{path:{type:String,default:"*"},exact:{type:Boolean,default:!1},url:{type:String,default:""}},events:{show:Event,hide:Event,error:Event,unauthorized:Event,forbidden:Event,notfound:Event},init(t){this._locationHandler=this._locationHandler.bind(this),this._error=this._error.bind(this),this._content=t.innerHTML,this._keys=[],this._re=dmx.pathToRegexp(this.props.path,this._keys,{end:this.props.exact}),this._shown=!1,t.innerHTML="",window.addEventListener("popstate",this._locationHandler),window.addEventListener("pushstate",this._locationHandler),window.addEventListener("replacestate",this._locationHandler),window.addEventListener("hashchange",this._locationHandler),this._locationHandler()},destroy(){window.removeEventListener("popstate",this._locationHandler),window.removeEventListener("pushstate",this._locationHandler),window.removeEventListener("replacestate",this._locationHandler),window.removeEventListener("hashchange",this._locationHandler)},performUpdate(t){this.set({path:this.props.path,isExact:this.props.exact})},_load(){this._hide(),this.set("loading",!0),this._abortController=new AbortController;const t=this.props.url;fetch(t,{credentials:"same-origin",signal:this._abortController.signal}).then((t=>t.text())).then((e=>{this.set("loading",!1),this._loaded=t,this._content=e,this._show()})).catch(this._error)},_show(){this._shown||(this._abortController&&this._abortController.abort(),this.$node.innerHTML=this._content,this.$parse(),dmx.routing.evalScripts(this.$node),this._shown=!0,this.dispatchEvent("show"))},_hide(){this._shown&&(this._abortController&&this._abortController.abort(),this.effects&&(this.effects.forEach((t=>t())),this.effects=null),this.$destroyChildren(),this._shown=!1,this.dispatchEvent("hide"))},_error(t){this.set("loading",!1),this.dispatchEvent("error"),dmx.debug&&console.error(t)},_locationHandler(t){const e=dmx.routing.getUrlInfo().path,i=this._re.exec(e);if(i){if(this.set({isMatch:!0,url:i[0],params:this._keys.reduce(((t,e,r)=>(t[e.name]=i[r+1],t)),{})}),this.data.loading&&this.props.url===this._loaded)return;this.props.url&&this.props.url!==this._loaded?this._load():this._show()}else this.set({isMatch:!1,url:"",params:{}}),this._hide()}}),dmx.Component("view",{initialData:{loading:!1,params:null},events:{load:Event,error:Event,unauthorized:Event,forbidden:Event,notfound:Event},init(t){window.__WAPPLER__||(this._locationHandler=this._locationHandler.bind(this),window.addEventListener("popstate",this._locationHandler),window.addEventListener("pushstate",this._locationHandler),window.addEventListener("replacestate",this._locationHandler),window.addEventListener("hashchange",this._locationHandler),"hybrid"==dmx.routing.router?this._url=location.pathname:this._locationHandler())},destroy(){window.removeEventListener("popstate",this._locationHandler),window.removeEventListener("pushstate",this._locationHandler),window.removeEventListener("replacestate",this._locationHandler),window.removeEventListener("hashchange",this._locationHandler)},_load(t){this._url==t&&this.data.loading||this._url!=t&&(this.set("loading",!0),this._url=t,this._abortController&&this._abortController.abort(),this._abortController=new AbortController,fetch(t+(t.includes("?")?"&":"?")+"fragment=true",{credentials:"same-origin",headers:[["Accept","text/fragment+html"]],signal:this._abortController.signal}).then((t=>{if(this.set("loading",!1),200==t.status||0==t.status)t.text().then((t=>{this._show(t),this.dispatchEvent("load"),window.dispatchEvent(new Event("load"))})).catch((t=>{this.dispatchEvent("error")}));else if(222==t.status)t.text().then((t=>{location.assign(t)})).catch((t=>{this.dispatchEvent("error")}));else{const e={401:"unauthorized",403:"forbidden",404:"notfound"};this.dispatchEvent(e[t.status]||"error")}})).catch((t=>{console.error(t),this.set("loading",!1),this.dispatchEvent("error")})))},_show(t){this.effects&&(this.effects.forEach((t=>t())),this.effects=null),this.$destroyChildren(),this.$node.innerHTML=t,this.$parse(),dmx.routing.evalScripts(this.$node)},_locationHandler(t){if("hybrid"==dmx.routing.router)this._load(location.pathname);else{let t=dmx.routing.getUrlInfo().path,e=dmx.routing.getRoutes(),i=this.parent;for(;i;){if(i.routes){e=i.routes;break}i=i.parent}const r=dmx.routing.match(t,e,i);r?(this.path=r.path,this.routes=r.routes,this.set("params",r.params),this._load(r.url)):console.warn("Route for "+t+" not found")}}}),dmx.Component("link",{attributes:{internal:{type:Boolean,default:!1}},init(t){this._clickHandler=this._clickHandler.bind(this),t.addEventListener("click",this._clickHandler)},destroy(){this.$node.removeEventListener("click",this._clickHandler)},_navigate(){let t=this.$node.getAttribute("href")||"";if(t.startsWith("#"))return void(location.hash=t);"hash"===dmx.routing.router&&(t="#!"+t);const e=this.$node.title;history.pushState({title:e||document.title},"",t),e&&(document.title=e),window.dispatchEvent(new Event("pushstate"))},_clickHandler(t){const e=this.$node.getAttribute("href")||"";!this.props.internal&&!e.startsWith("#")||t.ctrlKey||0!==t.button||(t.preventDefault(),this._navigate())}});
//# sourceMappingURL=../maps/dmxRouting.js.map
